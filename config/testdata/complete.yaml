address: 127.0.0.1:8888

environment: local

telemetry:
  address: 127.0.0.1:10000

  trace:
    sampler: always
    exporters:
      otlp:
        enabled: true
        address: 127.0.0.1:4317

  metrics:
    exporters:
      prometheus:
        enabled: true
      otlp:
        enabled: true
        address: 127.0.0.1:4317

  log:
    format: json
    level: info

namespace:
  default: default

ingest:
  kafka:
    broker: 127.0.0.1:9092
    securityProtocol: SASL_SSL
    saslMechanisms: PLAIN
    saslUsername: user
    saslPassword: pass
    partitions: 1
    statsInterval: 5s
    brokerAddressFamily: any
    socketKeepAliveEnabled: true
    topicMetadataRefreshInterval: 1m

aggregation:
  clickhouse:
    address: 127.0.0.1:9440
    tls: true
    username: default
    password: default
    database: openmeter

sink:
  groupId: openmeter-sink-worker
  minCommitCount: 500
  maxCommitWait: 30s
  namespaceRefetch: 15s
  dedupe:
    enabled: true
    driver: redis
    config:
      expiration: 768h # 32d
      database: 0
      address: 127.0.0.1:6379
      username: default
      password: pass
      tls:
        enabled: true

dedupe:
  enabled: true
  driver: redis
  config:
    expiration: 768h # 32d
    database: 0
    address: 127.0.0.1:6379
    username: default
    password: pass
    tls:
      enabled: true

meters:
  - slug: m1
    eventType: api-calls
    valueProperty: $.duration_ms
    aggregation: SUM
    groupBy:
      method: $.method
      path: $.path
