# OpenMeter Python SDK

[On PyPI](https://pypi.org/project/openmeter)

This package is generated by `@typespec/http-client-python` with Typespec.

## Prerequisites

- Python 3.9 or later is required to use this package.

## Install

> The Python SDK is in preview mode.

```sh
pip install openmeter
```

## Examples

### Setup

#### Synchronous Client

```python
from openmeter import Client

client = Client(
    endpoint="https://openmeter.cloud",
    token="your-api-token",
)
```

#### Async Client

```python
from openmeter.aio import Client

client = Client(
    endpoint="https://openmeter.cloud",
    token="your-api-token",
)
```

### Ingest an Event

#### Synchronous

```python
import datetime
import uuid

from openmeter.models import Event

# Create an Event instance (following CloudEvents specification)
event = Event(
    id=str(uuid.uuid4()),
    source="my-app",
    specversion="1.0",
    type="prompt",
    subject="customer-1",
    time=datetime.datetime.now(datetime.timezone.utc),
    data={
        "tokens": 100,
        "model": "gpt-4o",
        "type": "input",
    },
)

# Ingest the event
client.events.ingest_event(event)
```

#### Async

```python
import datetime
import uuid
import asyncio

from openmeter.aio import Client
from openmeter.models import Event

async def main():
    async with Client(
        endpoint="https://openmeter.cloud",
        token="your-api-token",
    ) as client:
        # Create an Event instance (following CloudEvents specification)
        event = Event(
            id=str(uuid.uuid4()),
            source="my-app",
            specversion="1.0",
            type="prompt",
            subject="customer-1",
            time=datetime.datetime.now(datetime.timezone.utc),
            data={
                "tokens": 100,
                "model": "gpt-4o",
                "type": "input",
            },
        )
        
        # Ingest the event
        await client.events.ingest_event(event)

asyncio.run(main())
```

### Query Meter

#### Synchronous

```python
from openmeter.models import MeterQueryResult

# Query total values
r: MeterQueryResult = client.meters.query_json(meter_id_or_slug="tokens_total")
print("Query total values:", r.data[0].value)
```

#### Async

```python
import asyncio

from openmeter.aio import Client
from openmeter.models import MeterQueryResult

async def main():
    async with Client(
        endpoint="https://openmeter.cloud",
        token="your-api-token",
    ) as client:
        # Query total values
        r: MeterQueryResult = await client.meters.query_json(
            meter_id_or_slug="tokens_total"
        )
        print("Query total values:", r.data[0].value)

asyncio.run(main())
```
