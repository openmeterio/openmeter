-- create "features" table
CREATE TABLE "features" (
  "id" character(26) NOT NULL,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "deleted_at" timestamptz NULL,
  "metadata" jsonb NULL,
  "namespace" character varying NOT NULL,
  "name" character varying NOT NULL,
  "key" character varying NOT NULL,
  "meter_slug" character varying NULL,
  "meter_group_by_filters" jsonb NULL,
  "archived_at" timestamptz NULL,
  PRIMARY KEY ("id")
);
-- create index "feature_id" to table: "features"
CREATE INDEX "feature_id" ON "features" ("id");
-- create index "feature_namespace_id" to table: "features"
CREATE INDEX "feature_namespace_id" ON "features" ("namespace", "id");
-- create "entitlements" table
CREATE TABLE "entitlements" (
  "id" character(26) NOT NULL,
  "namespace" character varying NOT NULL,
  "metadata" jsonb NULL,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "deleted_at" timestamptz NULL,
  "entitlement_type" character varying NOT NULL,
  "feature_key" character varying NOT NULL,
  "subject_key" character varying NOT NULL,
  "measure_usage_from" timestamptz NULL,
  "issue_after_reset" double precision NULL,
  "issue_after_reset_priority" smallint NULL,
  "is_soft_limit" boolean NULL,
  "preserve_overage_at_reset" boolean NULL,
  "config" jsonb NULL,
  "usage_period_interval" character varying NULL,
  "usage_period_anchor" timestamptz NULL,
  "current_usage_period_start" timestamptz NULL,
  "current_usage_period_end" timestamptz NULL,
  "feature_id" character(26) NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "entitlements_features_entitlement" FOREIGN KEY ("feature_id") REFERENCES "features" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
-- create index "entitlement_id" to table: "entitlements"
CREATE INDEX "entitlement_id" ON "entitlements" ("id");
-- create index "entitlement_namespace_current_usage_period_end" to table: "entitlements"
CREATE INDEX "entitlement_namespace_current_usage_period_end" ON "entitlements" ("namespace", "current_usage_period_end");
-- create index "entitlement_namespace_feature_id_id" to table: "entitlements"
CREATE INDEX "entitlement_namespace_feature_id_id" ON "entitlements" ("namespace", "feature_id", "id");
-- create index "entitlement_namespace_id" to table: "entitlements"
CREATE INDEX "entitlement_namespace_id" ON "entitlements" ("namespace", "id");
-- create index "entitlement_namespace_id_subject_key" to table: "entitlements"
CREATE INDEX "entitlement_namespace_id_subject_key" ON "entitlements" ("namespace", "id", "subject_key");
-- create index "entitlement_namespace_subject_key" to table: "entitlements"
CREATE INDEX "entitlement_namespace_subject_key" ON "entitlements" ("namespace", "subject_key");
-- create "balance_snapshots" table
CREATE TABLE "balance_snapshots" (
  "id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "namespace" character varying NOT NULL,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "deleted_at" timestamptz NULL,
  "grant_balances" jsonb NOT NULL,
  "balance" numeric NOT NULL,
  "overage" numeric NOT NULL,
  "at" timestamptz NOT NULL,
  "owner_id" character(26) NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "balance_snapshots_entitlements_balance_snapshot" FOREIGN KEY ("owner_id") REFERENCES "entitlements" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
-- create index "balancesnapshot_namespace_at" to table: "balance_snapshots"
CREATE INDEX "balancesnapshot_namespace_at" ON "balance_snapshots" ("namespace", "at");
-- create index "balancesnapshot_namespace_balance" to table: "balance_snapshots"
CREATE INDEX "balancesnapshot_namespace_balance" ON "balance_snapshots" ("namespace", "balance");
-- create index "balancesnapshot_namespace_balance_at" to table: "balance_snapshots"
CREATE INDEX "balancesnapshot_namespace_balance_at" ON "balance_snapshots" ("namespace", "balance", "at");
-- create "grants" table
CREATE TABLE "grants" (
  "id" character(26) NOT NULL,
  "namespace" character varying NOT NULL,
  "metadata" jsonb NULL,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "deleted_at" timestamptz NULL,
  "amount" numeric NOT NULL,
  "priority" smallint NOT NULL DEFAULT 0,
  "effective_at" timestamptz NOT NULL,
  "expiration" jsonb NOT NULL,
  "expires_at" timestamptz NOT NULL,
  "voided_at" timestamptz NULL,
  "reset_max_rollover" numeric NOT NULL,
  "reset_min_rollover" numeric NOT NULL,
  "recurrence_period" character varying NULL,
  "recurrence_anchor" timestamptz NULL,
  "owner_id" character(26) NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "grants_entitlements_grant" FOREIGN KEY ("owner_id") REFERENCES "entitlements" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
-- create index "grant_effective_at_expires_at" to table: "grants"
CREATE INDEX "grant_effective_at_expires_at" ON "grants" ("effective_at", "expires_at");
-- create index "grant_id" to table: "grants"
CREATE INDEX "grant_id" ON "grants" ("id");
-- create index "grant_namespace_owner_id" to table: "grants"
CREATE INDEX "grant_namespace_owner_id" ON "grants" ("namespace", "owner_id");
-- create "notification_channels" table
CREATE TABLE "notification_channels" (
  "id" character(26) NOT NULL,
  "namespace" character varying NOT NULL,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "deleted_at" timestamptz NULL,
  "type" character varying NOT NULL,
  "name" character varying NOT NULL,
  "disabled" boolean NULL DEFAULT false,
  "config" jsonb NOT NULL,
  PRIMARY KEY ("id")
);
-- create index "notificationchannel_id" to table: "notification_channels"
CREATE INDEX "notificationchannel_id" ON "notification_channels" ("id");
-- create index "notificationchannel_namespace_id" to table: "notification_channels"
CREATE INDEX "notificationchannel_namespace_id" ON "notification_channels" ("namespace", "id");
-- create index "notificationchannel_namespace_type" to table: "notification_channels"
CREATE INDEX "notificationchannel_namespace_type" ON "notification_channels" ("namespace", "type");
-- create "notification_rules" table
CREATE TABLE "notification_rules" (
  "id" character(26) NOT NULL,
  "namespace" character varying NOT NULL,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "deleted_at" timestamptz NULL,
  "type" character varying NOT NULL,
  "name" character varying NOT NULL,
  "disabled" boolean NULL DEFAULT false,
  "config" jsonb NOT NULL,
  PRIMARY KEY ("id")
);
-- create index "notificationrule_id" to table: "notification_rules"
CREATE INDEX "notificationrule_id" ON "notification_rules" ("id");
-- create index "notificationrule_namespace_id" to table: "notification_rules"
CREATE INDEX "notificationrule_namespace_id" ON "notification_rules" ("namespace", "id");
-- create index "notificationrule_namespace_type" to table: "notification_rules"
CREATE INDEX "notificationrule_namespace_type" ON "notification_rules" ("namespace", "type");
-- create "notification_channel_rules" table
CREATE TABLE "notification_channel_rules" (
  "notification_channel_id" character(26) NOT NULL,
  "notification_rule_id" character(26) NOT NULL,
  PRIMARY KEY ("notification_channel_id", "notification_rule_id"),
  CONSTRAINT "notification_channel_rules_notification_channel_id" FOREIGN KEY ("notification_channel_id") REFERENCES "notification_channels" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
  CONSTRAINT "notification_channel_rules_notification_rule_id" FOREIGN KEY ("notification_rule_id") REFERENCES "notification_rules" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);
-- create "notification_event_delivery_status" table
CREATE TABLE "notification_event_delivery_status" (
  "id" character(26) NOT NULL,
  "namespace" character varying NOT NULL,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "event_id" character varying NOT NULL,
  "channel_id" character varying NOT NULL,
  "state" character varying NOT NULL DEFAULT 'PENDING',
  "reason" character varying NULL,
  PRIMARY KEY ("id")
);
-- create index "notificationeventdeliverystatus_id" to table: "notification_event_delivery_status"
CREATE INDEX "notificationeventdeliverystatus_id" ON "notification_event_delivery_status" ("id");
-- create index "notificationeventdeliverystatus_namespace_event_id_channel_id" to table: "notification_event_delivery_status"
CREATE INDEX "notificationeventdeliverystatus_namespace_event_id_channel_id" ON "notification_event_delivery_status" ("namespace", "event_id", "channel_id");
-- create index "notificationeventdeliverystatus_namespace_id" to table: "notification_event_delivery_status"
CREATE INDEX "notificationeventdeliverystatus_namespace_id" ON "notification_event_delivery_status" ("namespace", "id");
-- create index "notificationeventdeliverystatus_namespace_state" to table: "notification_event_delivery_status"
CREATE INDEX "notificationeventdeliverystatus_namespace_state" ON "notification_event_delivery_status" ("namespace", "state");
-- create "notification_events" table
CREATE TABLE "notification_events" (
  "id" character(26) NOT NULL,
  "namespace" character varying NOT NULL,
  "created_at" timestamptz NOT NULL,
  "type" character varying NOT NULL,
  "payload" jsonb NOT NULL,
  "annotations" jsonb NULL,
  "rule_id" character(26) NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "notification_events_notification_rules_events" FOREIGN KEY ("rule_id") REFERENCES "notification_rules" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
-- create index "notificationevent_annotations" to table: "notification_events"
CREATE INDEX "notificationevent_annotations" ON "notification_events" USING gin ("annotations");
-- create index "notificationevent_id" to table: "notification_events"
CREATE INDEX "notificationevent_id" ON "notification_events" ("id");
-- create index "notificationevent_namespace_id" to table: "notification_events"
CREATE INDEX "notificationevent_namespace_id" ON "notification_events" ("namespace", "id");
-- create index "notificationevent_namespace_type" to table: "notification_events"
CREATE INDEX "notificationevent_namespace_type" ON "notification_events" ("namespace", "type");
-- create "notification_event_delivery_status_events" table
CREATE TABLE "notification_event_delivery_status_events" (
  "notification_event_delivery_status_id" character(26) NOT NULL,
  "notification_event_id" character(26) NOT NULL,
  PRIMARY KEY ("notification_event_delivery_status_id", "notification_event_id"),
  CONSTRAINT "notification_event_delivery_status_events_notification_event_de" FOREIGN KEY ("notification_event_delivery_status_id") REFERENCES "notification_event_delivery_status" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
  CONSTRAINT "notification_event_delivery_status_events_notification_event_id" FOREIGN KEY ("notification_event_id") REFERENCES "notification_events" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);
-- create "usage_resets" table
CREATE TABLE "usage_resets" (
  "id" character(26) NOT NULL,
  "namespace" character varying NOT NULL,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "deleted_at" timestamptz NULL,
  "reset_time" timestamptz NOT NULL,
  "entitlement_id" character(26) NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "usage_resets_entitlements_usage_reset" FOREIGN KEY ("entitlement_id") REFERENCES "entitlements" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
-- create index "usagereset_id" to table: "usage_resets"
CREATE INDEX "usagereset_id" ON "usage_resets" ("id");
-- create index "usagereset_namespace_entitlement_id" to table: "usage_resets"
CREATE INDEX "usagereset_namespace_entitlement_id" ON "usage_resets" ("namespace", "entitlement_id");
-- create index "usagereset_namespace_entitlement_id_reset_time" to table: "usage_resets"
CREATE INDEX "usagereset_namespace_entitlement_id_reset_time" ON "usage_resets" ("namespace", "entitlement_id", "reset_time");
